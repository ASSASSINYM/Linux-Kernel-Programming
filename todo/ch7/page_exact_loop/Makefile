# Makefile : auto-generated by script xcc_lkm.sh
# For 'Learn Linux Kernel Development', Kaiwan N Billimoria, Packt
#  [...]/page_exact
#
# To support cross-compiling for kernel modules:
# For architecture (cpu) 'arch', invoke make as:
# make ARCH=<arch> CROSS_COMPILE=<cross-compiler-prefix> 
ifeq ($(ARCH),arm)
    # *UPDATE* 'KDIR' below to point to the ARM Linux kernel source tree on your box
    KDIR ?= ~/rpi_work/rpi_kernel
else ifeq ($(ARCH),powerpc)
    # *UPDATE* 'KDIR' below to point to the PPC64 Linux kernel source tree on your box
    KDIR ?= ~/kernel/linux-4.9.1
else
    # x86[_64]: 'KDIR' is the Linux kernel source tree (headers) on your box
    KDIR ?= /lib/modules/$(shell uname -r)/build
endif

PWD	            := $(shell pwd)
obj-m               += page_exact_loop_chk.o
#page_exact_chk-objs := page_exact.o ../../klib_llkd.o
page_exact_loop_chk-objs := page_exact_loop.o ../../../klib_llkd.o
EXTRA_CFLAGS        += -DDEBUG -Wformat=0
 # we use the -Wformat=0 above to subdue the warning on the printk %llx format
 # specifier (in our klib_llkd.c code) as we _want_ to show the actual address
 # and not a hashed value; don't do this in production
$(info Building for: ARCH=${ARCH} CROSS_COMPILE=${CROSS_COMPILE} EXTRA_CFLAGS=${EXTRA_CFLAGS})

all:
	make -C $(KDIR) M=$(PWD) modules
install:
	make -C $(KDIR) M=$(PWD) modules_install
clean:
	make -C $(KDIR) M=$(PWD) clean
